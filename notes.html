<html lang="en">
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">

    <Title>DS Notes</Title>

    <link rel="stylesheet" href="themes.css">
    <link rel="stylesheet" href="notes.css">
    <link rel="stylesheet" href="settings.css">

  </head>
  <body>
    <div id="container">
      <div id="upper">
        <div id="upper-left">
          i
        </div>
        <div id="upper-middle">
          <p class="header-text">Notes</p>
        </div>
        <div id="upper-right">
          s
        </div>
      </div>
      <div id="lower">
        <textarea id="txt" spellcheck="false" style="display: none"></textarea>
        <div id="settings" style="display: null">
          <div id="settings-left">
            <p class="settings-header">Theme</p>
            <div class="settings-item">light</div>
            <div class="settings-item">dark</div>
            <div class="settings-item">yellow</div>
          </div>
          <div id="settings-right">
            <p class="settings-header">Font Size</p>
            <div id="settings-right-items">
              <div class="settings-item si-right">
                <p>8</p>
              </div>
              <div class="settings-item si-right">
                <p>10</p>
              </div>
              <div class="settings-item si-right">
                <p>12</p>
              </div>
              <div class="settings-item si-right">
                <p>14</p>
              </div>
              <div class="settings-item si-right">
                <p>18</p>
              </div>
              <div class="settings-item si-right">
                <p>24</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      var appState = {
        openWindow: "main"
      };

      // Immediately invoked function to set the theme on initial load
      (function () {
        // if (localStorage.getItem('theme') === 'theme-dark') {
        //     setTheme('theme-dark');
        // } else {
        //     setTheme('theme-light');
        // }
        switch (localStorage.getItem('theme')) {
          case 'theme-light':
            setTheme('theme-light');
            break;
          case 'theme-dark':
            setTheme('theme-dark');
            break;
          case 'theme-notes':
            setTheme('theme-notes');
            break;
          default:
            setTheme('theme-light');
        }
      })();

      var settingsBtn = document.getElementById("upper-right");
      settingsBtn.addEventListener('click', toggleSettings);

      function toggleSettings() {
        var target = document.getElementById("lower");

        if (appState.openWindow !== "settings") {
          showSettings();
          // set other div style to display: none
          // set settings div style do display: null
          appState.openWindow = "settings";
          console.log(appState.openWindow);
        } else {
          lower.innerHTML = '<textarea id="txt" spellcheck="false"></textarea>';
          // set other div style to display: none
          // set settings div style to display: null
          textarea = document.getElementById("txt");
          textarea.addEventListener('input', writeLocalStorage);
          readLocalStorage();
          appState.openWindow = "main";
        }
      }
      
      var textarea = document.getElementById("txt");
      textarea.addEventListener('input', writeLocalStorage);

      function setTheme(themeName) {
        console.log("TODO DELETE we're in setTheme");
        localStorage.setItem('theme', themeName);
        // TODO: maybe we need to specifically remove any current theme
        // class names, but leave other class names?
        // should be fine for now, but could be a problem later
        // if stuff has other classes
        // document.documentElement.className = themeName;
        document.documentElement.classList.remove("theme-light", "theme-dark", "theme-notes");
        document.documentElement.classList.add(themeName);
      }


      function changeTheme(event) {
        switch (event.currentTarget.id) {
          case "select-theme-light":
            setTheme("theme-light");
            break;
          case "select-theme-dark":
            setTheme("theme-dark");
            break;
          case "select-theme-notes":
            setTheme("theme-notes");
            break;
        }
      }


      function showSettings() {
        lower.innerHTML = "";

        var themeList = document.createElement('ul');
        var selectThemeLight = document.createElement('li');
        selectThemeLight.innerText = "Light";
        selectThemeLight.id = "select-theme-light";
        var selectThemeDark = document.createElement('li');
        selectThemeDark.innerText = "Dark";
        selectThemeDark.id = "select-theme-dark";
        var selectThemeNotes = document.createElement('li');
        selectThemeNotes.innerText = "Notes";
        selectThemeNotes.id = "select-theme-notes";

        themeList.classList.add('menu-text');

        // selectThemeLight.addEventListener('click', setTheme ("theme-light"));
        // selectThemeDark.addEventListener('click', setTheme ("theme-dark"));
        // selectThemeNotes.addEventListener('click', setTheme ("theme-notes"));
        selectThemeLight.addEventListener('click', changeTheme);
        selectThemeDark.addEventListener('click', changeTheme);
        selectThemeNotes.addEventListener('click', changeTheme);

        lower.appendChild(themeList);
        themeList.appendChild(selectThemeLight);
        themeList.appendChild(selectThemeDark);
        themeList.appendChild(selectThemeNotes); 

        console.log("finished showSettings()");
      }


      function writeLocalStorage() {
        if (typeof(Storage) !== "undefined") {
            localStorage.setItem("text", textarea.value);
        } else {
            document.getElementById("err").innerHTML = "Localstorage not supported";
        }
      }


      function readLocalStorage() {
        if (typeof(Storage) !== "undefined") {
            textarea.value = localStorage.getItem("text");
        } else {
            document.getElementById("err").innerHTML = "Localstorage not supported";
        }
      }


      // `DOMContentLoaded` may fire before your script has a chance to run, so check before adding a listener
      if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", readLocalStorage);
      } else {  // `DOMContentLoaded` already fired
          readLocalStorage();
      }
      
    </script>
  </body>
</html>
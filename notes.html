<html lang="en">
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">

    <Title>DS Notes</Title>

    <link rel="stylesheet" href="themes.css">
    <link rel="stylesheet" href="notes.css">
    <link rel="stylesheet" href="settings.css">

  </head>
  <body>
    <div id="container">
      <div id="upper">
        <div id="upper-left">
          i
        </div>
        <div id="upper-middle">
          <p class="header-text">Notes</p>
        </div>
        <div id="upper-right">
          s
        </div>
      </div>
      <div id="lower">
        <textarea id="txt" spellcheck="false" style="display: inline"></textarea>
        <div id="settings" style="display: none">
          <div id="settings-left">
            <p class="settings-header">Theme</p>
            <div class="settings-item" id="select-theme-light">light</div>
            <div class="settings-item" id="select-theme-dark">dark</div>
            <div class="settings-item" id="select-theme-yellow">yellow</div>
          </div>
          <div id="settings-right">
            <p class="settings-header">Font Size</p>
            <div id="settings-right-items">
              <div class="settings-item si-right" id="select-fontsize-8">
                <p>8</p>
              </div>
              <div class="settings-item si-right" id="select-fontsize-10">
                <p>10</p>
              </div>
              <div class="settings-item si-right" id="select-fontsize-12">
                <p>12</p>
              </div>
              <div class="settings-item si-right" id="select-fontsize-14">
                <p>14</p>
              </div>
              <div class="settings-item si-right" id="select-fontsize-18">
                <p>18</p>
              </div>
              <div class="settings-item si-right" id="select-fontsize-24">
                <p>24</p>
              </div>
            </div>
          </div>
        </div>
        <div id="info" style="display: none">
          Dockside Apps - 2021 - www.github.com/c-ehrlich
        </div>
      </div>
    </div>
    <script>
      var appState = {
        openWindow: "main"
      };

      // Immediately invoked function to set visual state (theme, font size) on initial load
      (function () {
        switch (localStorage.getItem('theme')) {
          case 'theme-light':
            setTheme('theme-light');
            break;
          case 'theme-dark':
            setTheme('theme-dark');
            break;
          case 'theme-yellow':
            setTheme('theme-yellow');
            break;
          default:
            setTheme('theme-light');
        }
        // textarea.value = localStorage.getItem("text");
        document.getElementById('txt').style.fontSize = localStorage.getItem("font-size");
      })();

      document.getElementById('upper-left').addEventListener('click', toggleInfo);
      document.getElementById("upper-right").addEventListener('click', toggleSettings);
      document.getElementById("upper-middle").addEventListener('click', function() {
        document.getElementById('settings').style.display = 'none';
        document.getElementById('info').style.display = 'none';
        document.getElementById('txt').style.display = 'inline';
        appState.openWindow = "main";
      });

      // leaving this as a variable declaration for now because it's used in some other places
      // TODO change that so this can be a single line
      var textarea = document.getElementById("txt");
      textarea.addEventListener('input', writeLocalStorage);


      function toggleSettings() {
        if (appState.openWindow !== "settings") {
          document.getElementById('txt').style.display = 'none';
          document.getElementById('info').style.display = 'none';
          document.getElementById('settings').style.display = 'flex'
          appState.openWindow = "settings";
        } else {
          document.getElementById('settings').style.display = 'none';
          document.getElementById('info').style.display = 'none';
          document.getElementById('txt').style.display = 'inline';
          appState.openWindow = "main";
        }
      }


      function toggleInfo() {
        if (appState.openWindow !== "info") {
          document.getElementById('txt').style.display = 'none';
          document.getElementById('settings').style.display = 'none';
          document.getElementById('info').style.display = 'inline'
          appState.openWindow = "info";
        } else {
          document.getElementById('settings').style.display = 'none';
          document.getElementById('info').style.display = 'none';
          document.getElementById('txt').style.display = 'inline';
          appState.openWindow = "main";
        }
      }


      document.getElementById('select-theme-light').addEventListener('click', changeTheme);
      document.getElementById('select-theme-dark').addEventListener('click', changeTheme);
      document.getElementById('select-theme-yellow').addEventListener('click', changeTheme);

      document.getElementById('select-fontsize-8').addEventListener('click', changeFontSize);
      document.getElementById('select-fontsize-10').addEventListener('click', changeFontSize);
      document.getElementById('select-fontsize-12').addEventListener('click', changeFontSize);
      document.getElementById('select-fontsize-14').addEventListener('click', changeFontSize);
      document.getElementById('select-fontsize-18').addEventListener('click', changeFontSize);
      document.getElementById('select-fontsize-24').addEventListener('click', changeFontSize);
    

      function setTheme(themeName) {
        localStorage.setItem('theme', themeName);
        // TODO instead of manually listing the themes, maybe put them all in an array or something somewhere
        // and then do it automatically
        document.documentElement.classList.remove("theme-light", "theme-dark", "theme-yellow");
        document.documentElement.classList.add(themeName);
      }


      function changeTheme(event) {
        switch (event.currentTarget.id) {
          case "select-theme-light":
            setTheme("theme-light");
            break;
          case "select-theme-dark":
            setTheme("theme-dark");
            break;
          case "select-theme-yellow":
            setTheme("theme-yellow");
            break;
        }
      }


      function changeFontSize(event) {
        var fontSize = event.currentTarget.id.split('-')[2];
        localStorage.setItem("font-size", fontSize);
        document.getElementById('txt').style.fontSize = fontSize;
      }


      function writeLocalStorage() {
        if (typeof(Storage) !== "undefined") {
            localStorage.setItem("text", textarea.value);
        } else {
            document.getElementById("err").innerHTML = "Localstorage not supported";
        }
      }


      function readLocalStorage() {
        if (typeof(Storage) !== "undefined") {
            textarea.value = localStorage.getItem("text");
        } else {
            document.getElementById("err").innerHTML = "Localstorage not supported";
        }
      }


      // `DOMContentLoaded` may fire before your script has a chance to run, so check before adding a listener
      if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", readLocalStorage);
      } else {  // `DOMContentLoaded` already fired
          readLocalStorage();
      }
      
    </script>
  </body>
</html>